name: Check license file
on:
  push:
    branches: [ "main" ]
  pull_request:

jobs:
  check-license-file:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@08eba0b27e820071cde6df949e0beb9ba4906955 # v4.3.0
      
      # For some reason, below diff is shown and only in CI and CI fails but not in local machine.
      # As a workaround, we added a line break reluctantly.
      # https://github.com/kyu08/fzf-make/pull/540/commits/fa617f413e1248f45b2c6cff1bd165b869c12bc7
      #
      # diff --git a/CREDITS.html b/CREDITS.html
      # index ea33347..503b190 100644
      # --- a/CREDITS.html
      # +++ b/CREDITS.html
      # @@ -2978,6 +2978,7 @@ Copyright 2010-2014 Rich Geldreich and Tenacious Software LLC
      #  Copyright (c) 2017 Frommi
      #  Copyright (c) 2017-2024 oyvindln
      #  
      # +
      #  Permission is hereby granted, free of charge, to any person obtaining a copy
      #  of this software and associated documentation files (the &quot;Software&quot;), to deal
      #  in the Software without restriction, including without limitation the rights
      - name: Check and update license file
        run: |
          make update-license-file
      
      - name: Check diff
        run: |
          git add .
          git diff --cached --exit-code
